<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="adminStyle.css">
</head>

<section id="modalWrapper">
    <button id="close">&times</button><br>
    <section id="categoryList">
        <div class="category" id="playersCategory">Gracze</div>
        <div class="category" id="gameplayCategory">Rozgrywka</div>
    </section>
    <p id="error">Wprowadź poprawne dane</p>

    <section class="categoryContainer" id="playersContainer">
        <fieldset id="playersInfo">
            <legend>Gracze</legend>
            <div id="playersContainer"></div>
        </fieldset>
        <div id="addBotWrapper">
            <input type="text" name="botNick" id="botNick" placeholder="Pseudonim bota">
            <input type="checkbox" name="randBot" id="randBot">
            <label for="randBot">Bot losujący</label><br>
            <button id="addBot">Dodaj bota</button>
        </div>
    </section>

    <section class="categoryContainer" id="gameplayContainer">
        <fieldset id="parametersContainer">
            <div>
                <label for="turnInput">Tura: </label>
                <input type="number" name="turnInput" id="turnInput" placeholder="Zmień turę">
            </div>
            <div>
                <label for="turnInput">Opóźnienie nowej gry: </label>
                <input type="number" name="delayInput" id="delayInput" step="0.1" placeholder="W sekundach">
            </div>
            <div>
                <label for="turnInput">Dopełniaj grę botami losującymi: </label>
                <input type="checkbox" name="fullfilInput" id="fullfilInput">
            </div>
            <button id="apply">Ustaw</button>
        </fieldset>
        <div id="stateContainer">
            <button class="stateButton" id="pause">Pauza</button>
            <button class="stateButton" id="unpause">Wznów</button>
            <button class="stateButton" id="drop">Koniec</button>
        </div>
    </section>
</section>
</html>

<script>
    document.getElementById("close").onclick = function() { 
        window.parent.postMessage("closeModal", "*"); 
    };
    document.getElementById("playersCategory").onclick = function() { 
        document.getElementById("playersCategory").style.bottom = "4px";
        document.getElementById("gameplayCategory").style.bottom = "0px";

        document.getElementById("playersContainer").style.display = "block";
        document.getElementById("gameplayContainer").style.display = "none";
    };
    document.getElementById("gameplayCategory").onclick = function() { 
        document.getElementById("playersCategory").style.bottom = "0px";
        document.getElementById("gameplayCategory").style.bottom = "4px";

        document.getElementById("playersContainer").style.display = "none";
        document.getElementById("gameplayContainer").style.display = "block";
    };

    window.addEventListener("message", function(event) {
        document.getElementById("close").onclick = function() { 
            window.parent.postMessage("closeModal", "*"); 
        };
        if(event.data === "showAdmin") {
            let adminData = JSON.parse(sessionStorage.getItem("adminData"));
            if(adminData.players === null)
                window.parent.postMessage("closeModal", "*"); 

            let childrenArray = [];
            for(let i = 0; i < adminData.players.length; i++){
                const wrapper = document.createElement("div");
                const par = document.createElement("p");
                const txt = document.createTextNode("[" + adminData.players[i][0] + "] " + adminData.players[i][1]);
                const button = document.createElement("button");

                par.appendChild(txt);
                button.classList.add("kick");

                wrapper.classList.add("playerWrapper");
                wrapper.appendChild(par);
                wrapper.appendChild(button);
                childrenArray.push(wrapper);
            }
            document.getElementById("playersContainer").replaceChildren(...childrenArray);
            console.log(adminData.players);
        }
    });
</script>
