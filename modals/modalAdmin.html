<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="adminStyle.css">
</head>

<section id="modalWrapper">
    <button id="close">&times</button><br>
    <section id="categoryList">
        <div class="category" id="playersCategory">Gracze</div>
        <div class="category" id="gameplayCategory">Rozgrywka</div>
    </section>
    <p id="error">Wprowadź poprawne dane</p>

    <section class="categoryContainer" id="playersContainer">
        <fieldset id="playersInfo">
            <section id="playersDataContainer"></section>
        </fieldset>

        <input type="radio" name="playerOption" class="playerOption" value="Kick" id="kick" onchange="playerOptionChange(this)">
        <label for="kick" class="playerOptionLabel">Wyrzuć</label><br/>
        <input type="radio" name="playerOption" class="playerOption" value="ClearPlayer" id="clearPlayer" onchange="playerOptionChange(this)">
        <label for="clearPlayer" class="playerOptionLabel">Wyczyść pionki</label><br/>
        <input type="radio" name="playerOption" class="playerOption" value="SetNick" id="setNick" onchange="playerOptionChange(this)">
        <label for="setNick" class="playerOptionLabel">Zmień nazwę</label>
        <input type="text" name="newNick" id="newNick" placeholder="Nowa nazwa...">

        <div id="addBotWrapper">
            <input type="text" name="botNick" id="botNick" placeholder="Pseudonim bota">
            <input type="checkbox" name="randBot" id="randBot">
            <label for="randBot">Bot losujący</label><br>
            <button id="addBot">Dodaj bota</button>
        </div>
    </section>

    <section class="categoryContainer" id="gameplayContainer">
        <fieldset id="parametersContainer">
            <div>
                <label for="turnInput">Tura: </label>
                <input type="number" name="turnInput" id="turnInput" placeholder="Zmień turę">
            </div>
            <div>
                <label for="turnInput">Opóźnienie nowej gry: </label>
                <input type="number" name="delayInput" id="delayInput" step="0.1" placeholder="W sekundach">
            </div>
            <div>
                <label for="turnInput">Dopełniaj grę botami losującymi: </label>
                <input type="checkbox" name="fullfilInput" id="fullfilInput">
            </div>
            <button id="apply">Ustaw</button>
        </fieldset>
        <div id="stateContainer">
            <button class="stateButton" id="pause">Pauza</button>
            <button class="stateButton" id="unpause">Wznów</button>
            <button class="stateButton" id="drop">Koniec</button>
        </div>
    </section>
</section>
</html>

<script>
    let chosenPlayer = null;

    window.onload = function(){
        window.postMessage("showAdmin", "*"); 
    }

    document.getElementById("close").onclick = function() { 
        window.parent.postMessage("closeModal", "*"); 
    };
    document.getElementById("playersCategory").onclick = function() { 
        document.getElementById("playersCategory").style.bottom = "4px";
        document.getElementById("gameplayCategory").style.bottom = "0px";

        document.getElementById("playersContainer").style.display = "block";
        document.getElementById("gameplayContainer").style.display = "none";
    };
    document.getElementById("gameplayCategory").onclick = function() { 
        document.getElementById("playersCategory").style.bottom = "0px";
        document.getElementById("gameplayCategory").style.bottom = "4px";

        document.getElementById("playersContainer").style.display = "none";
        document.getElementById("gameplayContainer").style.display = "block";
    };

    window.addEventListener("message", function(event) {
        document.getElementById("close").onclick = function() { 
            window.parent.postMessage("closeModal", "*"); 
        };
        if(event.data === "showAdmin") {
            let adminData = JSON.parse(sessionStorage.getItem("adminData"));

            if(adminData.players === null)
                window.parent.postMessage("closeModal", "*"); 

            let childrenArray = [];
            for(let i = 0; i < adminData.players.length; i++){
                const wrapper = document.createElement("div");
                const id = document.createElement("p");
                const par = document.createElement("p");

                id.appendChild(document.createTextNode("[" + adminData.players[i][0] + "] "));
                par.appendChild(document.createTextNode(adminData.players[i][1]));
                id.classList.add("playerID");
                wrapper.classList.add("playerWrapper");
                wrapper.appendChild(id);
                wrapper.appendChild(par);
                wrapper.addEventListener("click", function () {
                    playerClick(this);
                });
                childrenArray.push(wrapper);
            }
            document.getElementById("playersDataContainer").replaceChildren(...childrenArray);
        }
    });

    function playerClick(playerTag){
        const playersTags = document.getElementById("playersDataContainer").children;
        for(let child of playersTags)
            child.style.backgroundColor = "transparent";
        playerTag.style.backgroundColor = "rgba(255, 255, 255, 0.6)";
        chosenPlayer = playerTag.children[1].innerText;
    }

    function playerOptionChange(radio){
        if(radio.value === "SetNick"){
            document.getElementById("newNick").style.display = "block";
        }
        else{
            document.getElementById("newNick").style.display = "none";
        }
    }
</script>
